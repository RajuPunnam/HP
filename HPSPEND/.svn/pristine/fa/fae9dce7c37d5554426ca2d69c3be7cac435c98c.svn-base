package com.techouts.hp.service;

import java.text.SimpleDateFormat;

import org.apache.log4j.Logger;
import org.apache.poi.ss.usermodel.Cell;
import org.apache.poi.ss.usermodel.DateUtil;
import org.springframework.stereotype.Service;

/**
 * ExcelService class to to identify celltype
 * @author raju.p
 *
 */
@Service
public class ExcelService {
	private static final Logger LOG = Logger.getLogger(ExcelService.class);
	private static final SimpleDateFormat SDF = new SimpleDateFormat("MM/dd/yyyy");

	/**
	 * Finds cell value type
	 * @param cell
	 * @return cellData
	 */
	public String getCellData(Cell cell) {

		String cellData = null;
		if (cell == null) {
			return "";
		}
		try {
			switch (cell.getCellType()) {
			case Cell.CELL_TYPE_BOOLEAN:
				cellData = cell.getBooleanCellValue() + "";
				break;
			case Cell.CELL_TYPE_FORMULA:

				switch (cell.getCachedFormulaResultType()) {
				case Cell.CELL_TYPE_NUMERIC:
					if (DateUtil.isCellDateFormatted(cell)) {
						cellData = SDF.format(cell.getDateCellValue()) + "";
					} else {
						cellData = cell.getNumericCellValue() + "";
					}
					break;
				case Cell.CELL_TYPE_STRING:
					cellData = cell.getStringCellValue() + "";
					break;
				case Cell.CELL_TYPE_ERROR:
					cellData = cell.getErrorCellValue() + "";
					break;
				case Cell.CELL_TYPE_BOOLEAN:
					cellData = cell.getBooleanCellValue() + "";
					break;
				default:
					cellData = cell.getStringCellValue() + "";
					break;
				}
				break;
			case Cell.CELL_TYPE_NUMERIC:
				if (DateUtil.isCellDateFormatted(cell)) {
					cellData = SDF.format(cell.getDateCellValue()) + "";
				} else {

					cellData = (int) cell.getNumericCellValue() + "";
				}
				break;
			case Cell.CELL_TYPE_STRING:
				String str = cell.getStringCellValue();
				String st1 = new String();

				if (str.contains("\"")) {
					String st[] = str.split("\"");
					for (int k = 0; k < st.length; k++) {
						st1 = st1 + st[k];
					}
					cellData = st1 + "";
				} else if (str.toString().equals("-")) {
					cellData = "";
				}

				else {
					cellData = cell.getStringCellValue() + "";
				}
				break;
			case Cell.CELL_TYPE_ERROR:
				if (cell.getErrorCellValue() == 42) {
					cellData = "";
				} else {
					cellData = cell.getErrorCellValue() + "";
				}
				break;
			case Cell.CELL_TYPE_BLANK:
				cellData = "";
				break;
			}
		} catch (Exception e) {
			LOG.info(e.getMessage());
		}
		return cellData;
	}
}
